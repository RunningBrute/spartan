{%extends "training/base.html"%}

{% block nav %}
<nav>
    <a href="{% url 'dashboard' %}">dashboard</a>
    <a href="{% url 'delete_workout' workout.id %}" onclick="return confirm('are you sure you want to delete this workout?')">delete</a>

    {% if workout.live %}
        <a href="{% url 'finish_workout' workout.id %}" onclick="return confirm('are you sure this is it?')">finish</a>
    {% endif %}
</nav>
{% endblock %}

{%block content%}

{% load staticfiles %}
{% load training_format %}

<script src="{% static 'training/stopwatch.js' %}"></script>

<h2>workout</h2>

<section>
    {%if workout.live%}
        <dl>
            <dt>duration</dt><dd><span id="stopwatch">--:--</span></dd>
            <dt>total reps</dt><dd>{{workout.total_reps}}</dd>
        </dl>
    {% elif not workout.started%}
        this workout has not beed started yet, add some excercise to do it
    {% elif workout.finished %}
        <dl>
            <dt>started</dt><dd>{{workout.started}}</dd>
            <dt>took</dt><dd>{{workout.duration|duration}}</dd>
            <dt>total reps</dt><dd>{{workout.total_reps}}</dd>
        </dl>
    {%endif%}
</section>

<h2>excercises</h2>
{%for excercise in workout.excercise_set.all%}
    <dl class="excercise box">
        <dt>
            <span class="name">{{excercise.name}}</span>

            {% if forloop.last and not workout.finished %}
                <span id="excercise_duration" class="note">{{excercise.duration|duration}}</span>
                <script>
                    $(document).ready(function() {
                        stopwatch("excercise_duration", new Date("{{excercise.time_started.isoformat}}"));
                    });
                </script>
            {% else %}
                <span class="note">{{excercise.duration|duration}}</span>
            {% endif %}
        </dt>

        <dd>
            <ul>
                {% for reps in excercise.reps_set.all %}
                    <li>{{reps.reps}}</li>
                {% endfor %}

                {% if excercise.total_reps > 0 %}
                    <li><strong>{{excercise.total_reps}}</strong></li>
                {% endif %}
            </ul>

            {% if forloop.last and excercise.time_updated and not workout.finished %}
                <span id="last_update_stopwatch">--</span>
                <script>
                    $(document).ready(function() {
                        stopwatch("last_update_stopwatch", new Date("{{ excercise.time_updated.isoformat }}"));
                    });
                </script>
            {% endif %}
        </dd>
    </dl>

    {% if forloop.last and not workout.finished %}
        <div class="box">
            <form action="{% url 'add_reps' excercise.id %}" method="post">
                {% csrf_token %}
                <input type="number" id="sets_{{ excercise.id }}" name="reps" value="{{ excercise.sets }}" placeholder="reps" required />
                <input type="submit" value="add" />
            </form>

            {%for rep,_ in most_common_reps|slice:":4"%}
                <form action="{% url 'add_reps' excercise.id %}" method="post">
                    {% csrf_token %}
                    <input type="hidden" name="reps" value="{{rep}}" />
                    <input type="submit" value="+{{rep}}" />
                </form>
            {%endfor%}
        </div>
    {%endif%}
{%empty%}
    <div class="box">you will be counting your reps here</div>
{%endfor%}

{% if not workout.finished %}
    <h2>start new excercise</h2>
    <section>
        <form action="{% url 'add_excercise' workout.id %}" method="post">
            {% csrf_token %}
            <input type="text" id="new_excercise_name" name="name" placeholder="name" required />
            <input type="submit" value="start" />
        </form>

        {%for excercise,_ in most_common_excercises|slice:":4"%}
            <form action="{% url 'add_excercise' workout.id %}" method="post">
                {% csrf_token %}
                <input type="hidden" name="name" value="{{excercise}}" />
                <input type="submit" value="{{excercise}}" />
            </form>
        {%endfor%}
    </section>
{% endif %}

{%if workout.finished%}
<h2>UTD string</h2>
<div class="box">
    <pre>{{ workout.utd }}</pre>
</div>
{%endif%}

<script>
    $(document).ready(function() {
        stopwatch("stopwatch", new Date("{{workout.started.isoformat}}"));
    });
</script>

{%endblock%}
