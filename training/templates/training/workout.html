{%extends "training/base.html"%}

{%block content%}

<h1>workout #{{workout.id}}</h1>

<nav>
    <a href="{% url 'index' %}">go back</a>
</nav>

{%if workout.live%}
<p>
    <form action="{% url 'finish_workout' workout.id %}" method="post">
        <fieldset class="major">
            {% csrf_token %}
            <input type="text" id="stopwatch" readonly />
            <input type="submit" value="finish" />
        </fieldset>
    </form>
</p>
{%endif%}


{%if not workout.started%}
<p>this workout has not beed started yet, add first excercise to do it</p>
{%endif%}

{%if workout.finished%}
<p>started at {{workout.started}} and finished at {{workout.finished}}</p>
{%endif%}

<p>
    <ul>
        {% for excercise in workout.excercise_set.all %}
            <li>
                <form action="{% url 'add_reps' excercise.id %}" method="post">
                    <fieldset class="minor">
                        {% csrf_token %}
                        <label for="sets_{{ excercise.id }}">
                            {{ excercise.name }}

                            {%for reps in excercise.reps_set.all%}
                                <span class="reps">{{reps.reps}}</span>
                            {%endfor%}
                        </label>
                        <input type="number" id="sets_{{ excercise.id }}" name="reps" value="{{ excercise.sets }}" placeholder="reps" />
                        <input type="submit" value="add" />
                    </fieldset>
                </form>


                <form action="{% url 'add_reps' excercise.id %}" method="post">
                    <fieldset class="minor">
                        {% csrf_token %}
                        <input type="hidden" name="reps" value="10" />
                        <input type="submit" value="+10" />
                    </fieldset>
                </form>

            </li>
        {% endfor %}
    </ul>
</p>

<p>
    <form action="{% url 'add_excercise' workout.id %}" method="post">
        <fieldset class="major">
            {% csrf_token %}
            <label for="new_excercise_name">start new excercise</label>
            <input type="text" id="new_excercise_name" name="name" placeholder="name" required />
            <input type="submit" value="start" />
        </fieldset>
    </form>
</p>

{%if workout.finished%}
<h1>UTD string</h1>
<p>
    <pre>
{{ workout.utd }}
    </pre>
</p>
{%endif%}

<script>
    function update_stopwatch(start_time)
    {
        now = new Date();

        var diff = now.getTime() - start_time.getTime();

        document.getElementById('stopwatch').value = format_time(diff);
        refresh = setTimeout(function() { update_stopwatch(start_time); }, 500);
    }

    function format_time(ms)
    {
        var second = Math.floor(ms/1000);
        var minute = Math.floor(ms/60000);
        second = second - 60 * minute + '';
        return minute + 'm ' + second + 's';
    }

    window.onload = function()
    {
        var start_time = new Date("{{workout.started.isoformat}}");
        update_stopwatch(start_time);
    };
</script>

{%endblock%}
